<div class="rating-list-container">
  <div class="header">
    <h2>Tous les avis sur les vols</h2>
    <div class="header-actions">
      <button *ngIf="isAdmin" class="logout-button" (click)="logout()">
        🔓 Se déconnecter
      </button>
      <button class="back-button" (click)="goBackToForm()">
        ← Retour au formulaire
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading-message">
    <p>Chargement des avis...</p>
  </div>

  <div *ngIf="error && !loading" class="error-message">
    <p>Erreur lors du chargement des avis. Veuillez réessayer.</p>
    <button (click)="loadRates()" class="retry-button">Réessayer</button>
  </div>

  <div *ngIf="!loading && !error && rates.length === 0" class="no-rates-message">
    <p>Aucun avis n'a encore été publié.</p>
    <button (click)="goBackToForm()" class="add-review-button">Ajouter le premier avis</button>
  </div>

  <div *ngIf="!loading && !error && rates.length > 0" class="rates-grid">
    <div *ngFor="let rate of rates" class="rate-card">
      <div class="rate-header">
        <div class="flight-info">
          <h3>Vol {{ rate.flightNumber }}</h3>
          <p class="airline">{{ rate.company }}</p>
          <p class="flight-date">Date du vol: {{ rate.flightDate }}</p>
        </div>
        <div class="rating-stars">
          <span *ngFor="let star of getStarArray(rate.rating)" 
                class="star" 
                [class.filled]="star">
            ★
          </span>
          <span class="rating-number">({{ rate.rating }}/5)</span>
        </div>
      </div>
      
      <div class="rate-content">
        <p class="comment">{{ rate.comment }}</p>
      </div>

      <!-- Section des réponses -->
      <div *ngIf="rate.rateResponse && rate.rateResponse.length > 0" class="rate-responses">
        <h4 class="responses-title">
          {{ rate.rateResponse.length === 1 ? 'Réponse de la compagnie' : 'Réponses de la compagnie' }}
        </h4>
        <div *ngFor="let response of rate.rateResponse" class="response-item">
          <div class="response-content">
            <p class="response-text">{{ response.response }}</p>
            <p class="response-date">{{ formatDate(response.responseAt) }}</p>
          </div>
        </div>
      </div>
      
      <div class="rate-footer">
        <div class="footer-content">
          <p class="submitted-date">
            Publié le {{ formatDate(rate.submittedAt ?? '') }}
          </p>
          <button *ngIf="isAdmin" class="respond-button" (click)="respondToRate(rate.id!)">
            💬 Répondre
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Popup de réponse -->
  <app-response-popup
    [isVisible]="showResponsePopup"
    [rateId]="selectedRateId"
    [flightNumber]="selectedFlightNumber"
    [company]="selectedCompany"
    (closePopup)="closeResponsePopup()"
    (responseAdded)="onResponseAdded($event)">
  </app-response-popup>
</div>
